<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>AOP ··· intro</title>

        <link rel="stylesheet" href="style/index.css">
        <link rel="stylesheet" href="style/theme/sky.css">
        <link rel="stylesheet" href="style/custom.css">

        <link rel="stylesheet" href="style/atom-one-light.css">
    </head>
    <body>
        <div class="reveal">
            <div class="slides">
                <section>
                    <img class="parrot" src="http://cultofthepartyparrot.com/parrots/boredparrot.gif"/>
                    <h3><b>Aspect Oriented Programming in JS</b></h3>
                    <p>
                        by <a href="https://github.com/ciroreed/">@ciroreed</a> feat <a href="http://cultofthepartyparrot.com/">Party Parrot</a>
                    </p>

                </section>
                <section>
                    <img class="parrot" src="http://cultofthepartyparrot.com/parrots/sadparrot.gif"/>
                    <p>
                        Raw Object oriented programming
                    </p>
                    <pre><code class="hljs" contenteditable>
class Invoice {
    ...
    applyTaxes(priceProduct){
        console.log(`'applyTaxes' - arguments: ${priceProduct}`)
        result = priceProduct * selectedCountry.tax
        console.log(`'applyTaxes' - return value: ${result}`)
        return result
    }
    ...
}
                    </code></pre>
                </section>
                <section>
                    <img class="parrot" src="http://cultofthepartyparrot.com/parrots/dealwithitparrot.gif"/>
                    <p>
                        OOP <b>with</b> Aspect oriented programming
                    </p>
                    <pre><code class="hljs" contenteditable>
class Invoice {
    ...
    @log
    applyTaxes(priceProduct){
        return priceProduct * selectedCountry.tax
    }
    ...
}
                    </code></pre>
                </section>
                <section phase-intro>
                    <section>
                        <h4>mm... Okay, Whut... </h4>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/confusedparrot.gif"/>
                        <p>
                            ¿What is AOP?
                        </p>
                    </section>
                    <section>
                        <p>
                            AOP is a paradigm which aims to <u>increase modularity</u> by allowing the separation of <b><i>cross-cutting concerns</i></b>
                        </p>
                        <br/>
                        <p>
                            AOP is about <u>abstraction</u> of your infrastructure code by <u>solving common problems with common solutions</u>
                        </p>
                    </section>
                    <section>
                        <h3><b>AOP is not ...</b></h3>
                        <ul>
                            <li>not language dependent</li>
                            <li>not a technology</li>
                            <li>not a patern</li>
                            <li>not very common in frontend environments.. why? :'(</li>
                            <li>not a solution for all problems, neither almost every problem</li>
                        </ul>
                    </section>
                    <section>
                        <h3><b>AOP is ...</b></h3>
                        <ul>
                            <li>a technique</li>
                            <li>framework agnostic</li>
                            <li>a toolkit against repetition</li>
                            <li>hard to master</li>
                            <li>an extension for OOP</li>
                        </ul>
                        <br/>
                        <br/>
                        <p>
                            Some frontend frameworks use it.., but does not allow you to use as you see fit!
                        </p>
                    </section>
                </section>
                <section>
                    <section>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/parrotsleep.gif"/>
                        <p>
                            let's jump into the code again!!
                        </p>
                    </section>
                    <section>
                        <p>
                            We have a simple Invoice class with a method to handle customer's checkout..
                        </p>
                        <pre><code class="hljs" contenteditable>
class Invoice {
    ...
    doCheckout(shippingDetails){
        this.shippingDetails = shippingDetails
    }
    ...
}
                        </code></pre>
                        <p>
                            It looks nice! so simple!
                        </p>
                    </section>
                    <section>
                        <p>
                            But now we're used to save customer's invoice using any ajax service...
                        </p>
                        <pre><code class="hljs" contenteditable>
class Invoice {
    ...
    doCheckout(shippingDetails){
        this.shippingDetails = shippingDetails
        $OurAjaxService.post({ //if we're using IoC (Dependency Injection)
            url: this.url,
            data: this
        }).then((response) => {
            //...notify the user or something, trigger the state
        })
    }
    ...
}
                        </code></pre>

                    </section>
                    <section>
                        <p>
                            And then, we need to validate customer's 'shippingDetails'
                        </p>
                        <pre><code class="hljs" contenteditable>
class Invoice {
    ...
    doCheckout(shippingDetails){
        if(this.validate(shippingDetails)){
            this.shippingDetails = shippingDetails
            $OurAjaxService.post({ //if we're using IoC (Dependency Injection)
                url: this.url,
                data: this
            }).then((response) => {
                //...notify the user or something, trigger the state
            })
        }
    }
    ...
}
                        </code></pre>

                    </section>
                    <section>
                        <p>
                            Let's say that our ajax service does not include JSON serialization
                        </p>
                        <pre><code class="hljs" contenteditable>
class Invoice {
    ...
    doCheckout(shippingDetails){
        if(this.validate(shippingDetails)){
            this.shippingDetails = shippingDetails
            var serializedInstance = JSON.stringify(this)
            $OurAjaxService.post({ //if we're using IoC (Dependency Injection)
                url: this.url,
                data: serializedInstance
            }).then((response) => {
                //...notify the user or something, trigger the state
            })
        }
    }
    ...
}
                        </code></pre>

                    </section>
                    <section>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/sadparrot.gif"/>
                        <p>
                            It's like our infrastucture code is hidding our business logic or <b>what this method is really trying to do</b>
                        </p>
                    </section>
                    <section>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/boredparrot.gif"/>
                        <p>
                            There are many infrastructure patterns that spread in many places in our project. Even in many of our projects...
                        </p>
                        <br/>
                        <p>
                            These are <b>corss-cutting concerns</b>.
                        </p>
                        <br/>
                        <p>
                            You're used to check if these bricks of infrastructure can be abstracted in order to be handled <b>in the same place</b>.
                        </p>
                    </section>
                </section>
                <section>
                    <section>
                        <p>
                            So, don't repeat yourself
                        </p>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/parrot.gif"/>

                        <pre><code class="hljs" contenteditable>
class Invoice {
    ...
    @before('validate')
    @after('serialize')
    @after('POST: "url"')
    @after('notify')
    doCheckout(shippingDetails){
        this.shippingDetails = shippingDetails
    }
    ...
}
                        </code></pre>

                    </section>
                    <section>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/parrotdad.gif"/>
                        <p>
                            <b>WTF! WHAT KIND OF SORCERY IS THIS?!1</b>
                        </p>

                        <p>
                            <b>HOW DO I DO THAT!?</b>
                        </p>

                        <p>
                            hurry up, explain this or GTFO!
                        </p>
                    </section>
                </section>
                <section>
                    <section>
                        <h3><b>How we can implement this?</b></h3>

                        <p>
                            Step by step
                        </p>
                    </section>
                    <section>
                        <p>Early example of AOP in JS:</p>
                        <pre><code class="hljs" contenteditable>
function logBefore(fn){
    return function(){
        console.log("called " + fn.name + " with " + arguments);
        return fn.apply(this, arguments);
    }
}

var dummyObject = {
    ...
    doSomething: function (someArgument){
        var somethign = someArgument + this.someAttribute;
        ...

        return something;
    }
};

dummyObject.doSomething = logBefore(dummyObject.doSomething);
                        </code></pre>
                    </section>
                    <section>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/middleparrot.gif"/>
                        <p>
                            Well, yeah... but my problems are quite harder than this piece of S***!
                        </p>
                    </section>
                    <section>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/slowparrot.gif"/>
                        <h4><b>Calm down..! </b></h4>
                        <p>
                            First of all we need to understand the purpose of that technique!
                        </p>
                        <br/>
                        <p>
                            Then you should change your way of thinking when coding. Instead of code <b>"what needs exactly to happen"</b> you should code your business and then <b>"apply that pattern"</b> before business logic, apply another after...
                        </p>
                        <br/>
                        <p>
                            <i>Or by describing what the program must accomplish in terms of the problem domain, rather than describe how to accomplish it (imperative).</i>
                        </p>
                    </section>
                    <section>
                        <p style="text-align: left">
                            AOP is an extension of IoC technique, we need to understand briefly how it works.
                        </p>
                        <br/>
                        <p style="text-align: left">
                            In a nutshell, AOP allows cross-cutting concerns to be implemented outside of the code affected by those concerns. So we need to indentify that <i>CCC</i> first.
                        </p>
                        <br/>
                        <p style="text-align: left">
                            <i>CCC</i> are usually about Error detection and correction, Data validation, Persistence, Transaction processing, Security, Caching, Logging, Monitoring... and so on.. we may also want to deal with problems that only occur in the web, like <b>animations, dom updates</b>... and so on.
                        </p>
                        <br/>
                        <p style="text-align: left">
                            Any <u>infrastucture code</u> which is repeated through the project is a prime candidate for an <b>Aspect</b> in AOP.
                        </p>
                    </section>
                </section>

                <section>
                    <section>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/parrotmustache.gif"/>
                        <h3><b>Technical definition</b></h3>
                        <p>
                            AOP is well described in many frameworks like Spring (Java), or PostSharp (.NET). There is a lot of documentation about. We're not used to discuss this here, just speak about the basics.
                        </p>
                        <ul>
                            <li>Aspects</li>
                            <li>Pointcuts</li>
                            <li>Weaving</li>
                        </ul>
                        <p>
                            We're skipping other concepts...
                        </p>
                    </section>
                    <section>
                        <h5><b>What is an Aspect?</b></h5>
                        <ul>
                            <li>An <b>Aspect</b> is a piece of code which encapsulates a <i>CCC</i>. It must be so well abstracted that we should able to use in more than one place, even other projects.</li>
                            <li>An Aspect describe a pattern in our codebase, which can be assembled or stacked with other aspects or methods in Class declarations.</li>
                            <li>An Aspect must access all the necessary objects, attributes or services to do the right suff at the right moment, then finish and delegate in the next piece of code.</li>
                            <li>An Aspect should be responsible to perform <b>one</b> operation. Only!</li>
                        </ul>
                    </section>
                    <section>
                        <h5><b>What is an Pointcut?</b></h5>
                        <ul>
                            <li>A Pointcut is a point in the execution where an Aspect <i>(advice)</i> can be injected.</li>
                            <li>A Pointcut is not an object or service, just a constant.</li>
                            <li>For example, <b>before</b> the method execution, <b>after</b> the method execution, <b>arround</b> the method execution, <b>creating</b> a class instance, <b>on error</b> during method execution, <b>on destroy</b> instance...</li>
                        </ul>
                    </section>
                    <section>
                        <h5><b>What is Weaving?</b></h5>
                        <ul>
                            <li>Is the process of transforming a class injecting aspects.</li>
                            <li>The resulting class still has reference to its upperclasses in hierarchy.</li>
                        </ul>
                    </section>
                    <section>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/parrotsleep.gif"/>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/parrotsleep.gif"/>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/boredparrot.gif"/>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/parrotsleep.gif"/>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/sadparrot.gif"/>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/confusedparrot.gif"/>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/parrotsleep.gif"/>
                    </section>
                </section>
                <section>
                    <section>
                        <img class="parrot" src="http://cultofthepartyparrot.com/parrots/fastparrot.gif"/>
                        <h3>known AOP implementations in <b>JS</b> and Examples!</h3>
                    </section>
                    <section>
                        <h4><a href="https://github.com/cujojs/meld/blob/master/docs/api.md">cujojs/meld</a></h4>
                        <pre><code class="hljs" contenteditable>
var myObject = {
    doSomething: function(a, b) {
        return a + b;
    }
};

// Call a function after myObject.doSomething returns
var remover = meld.after(myObject, 'doSomething', function(result) {
    console.log('myObject.doSomething returned: ' + result);
});

myObject.doSomething(1, 2); // Logs: "myObject.doSomething returned: 3"

remover.remove();

myObject.doSomething(1, 2); // Nothing logged
                        </code></pre>
                    </section>
                    <section>
                        <h4><a href="https://github.com/mgechev/angular-aop/tree/master/docs">mgechev/angular-aop</a></h4>
                        <pre><code class="hljs" contenteditable>
myModule.config(function ($provide, executeProvider) {
  executeProvider.annotate($provide, {
    ServiceToWove: [{
      jointPoint: JOINT_POINT,
      advice: ADVICE_NAME,
      methodPattern: /Special/
      argsPattern: [/arg1/, /arg2/]
    }, {
      jointPoint: JOINT_POINT
      advice: ADVICE_NAME
    }]
  });
});
                        </code></pre>
                    </section>
                    <section>
                        <h4><a href="https://github.com/ciroreed/kaop#method-decorators">ciroreed/kaop</a></h4>
                        <pre><code class="hljs" contenteditable>
Aspects.push(
    Phase.EXECUTE,
    function override() {
        meta.args.unshift(meta.parentScope[meta.methodName].bind(this));
    }
);

Programmer = Class.inherits(Person, {
  //aspect 'override' inject the SuperClass.constructor as first parameter
  constructor: ["override", function(parent, name, dborn, favouriteLanguage){
    parent(name, dborn) //like super() does
    this.favLang = favouriteLanguage
  }],
  run: ["override", function(parent){ //we simply override it to change its behavior
    return parent() + " but... not as faster, coz im fat :/"
  }]
})
                        </code></pre>
                    </section>
                    <section>
                        <h4><b>Another example..</b></h4>
                        <p>
                            AOP is about remove infrastucture code from our business logic... right?, but our infrastructure code often is <b>asynchronous</b> :D
                        </p>
                        <pre><code class="hljs" contenteditable>
//KBase is an abstract dom element following webcomponents guidelines
module.exports = KInclude = Class.inherits(KBase, {
    attachedCallback: ["override", function(parent) {
        parent();
        this.path = this.attr("path");
        this.loadTemplate();
    }],
    loadTemplate: ["$GET: 'path', true", function(raw) {
        this.append(raw);
    }]
});
                        </code></pre>
                        &lt;k-include path="inc/partial.html" /&gt;

                    </section>
                </section>
                <section>
                    <h3>known AOP implementations in <b>TS/Babel</b> and Examples!</h3>

                </section>
            </div>
        </div>
        <script src="index.min.js" charset="utf-8"></script>
    </body>
</html>
